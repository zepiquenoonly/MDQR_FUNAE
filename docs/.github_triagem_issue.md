# ğŸ¤– Sistema de Triagem e AtribuiÃ§Ã£o AutomÃ¡tica de Grievances

## ğŸ¯ Objetivo

Implementar sistema inteligente de triagem automÃ¡tica que classifica e atribui grievances (Queixas, ReclamaÃ§Ãµes, SugestÃµes) ao tÃ©cnico mais adequado baseado em:
- **Disponibilidade** do tÃ©cnico
- **Carga de trabalho** atual
- **Tipo de grievance** (complaint, grievance, suggestion)
- **Categoria** (ambiental, social, econÃ³mico)
- **Prioridade** (low, medium, high, urgent)

## ğŸš¨ Problema Atual

- âŒ AtribuiÃ§Ã£o manual consome tempo do gestor
- âŒ NÃ£o hÃ¡ balanceamento automÃ¡tico de carga entre tÃ©cnicos
- âŒ TÃ©cnicos podem ficar sobrecarregados enquanto outros ficam ociosos
- âŒ NÃ£o considera especializaÃ§Ã£o por categoria/tipo
- âŒ Prioridades urgentes podem ser atrasadas

## âœ… SoluÃ§Ã£o Proposta

### 1ï¸âƒ£ **Service de Triagem Inteligente** (`GrievanceTriageService`)

```php
Algoritmo de pontuaÃ§Ã£o:
- Carga atual: -10 pontos por grievance ativa
- Categoria expertise: +20 pontos se tÃ©cnico tem experiÃªncia
- Tipo expertise: +15 pontos para tipo especÃ­fico
- Disponibilidade: +30 pontos se nÃ£o estÃ¡ em fÃ©rias/ausente
- Performance histÃ³rica: +10 pontos por boa taxa de resoluÃ§Ã£o
```

### 2ï¸âƒ£ **Migration para Expertise**

Adicionar campos Ã  tabela `users`:
- `expertise_categories` (JSON): ['ambiental', 'social']
- `expertise_types` (JSON): ['complaint', 'grievance']
- `is_available` (boolean): Status de disponibilidade
- `max_concurrent_grievances` (integer): Limite de carga

### 3ï¸âƒ£ **Regras de Triagem**

**Por Prioridade:**
- ğŸ”´ **Urgent**: Atribuir imediatamente ao tÃ©cnico menos ocupado
- ğŸŸ  **High**: Priorizar tÃ©cnicos com expertise na categoria
- ğŸŸ¡ **Medium**: Balancear carga entre tÃ©cnicos disponÃ­veis
- ğŸŸ¢ **Low**: Pode aguardar na fila se todos sobrecarregados

**Por Tipo:**
- **Complaint** (ReclamaÃ§Ã£o): TÃ©cnicos com experiÃªncia em resoluÃ§Ã£o rÃ¡pida
- **Grievance** (Queixa): TÃ©cnicos com habilidade em mediaÃ§Ã£o
- **Suggestion** (SugestÃ£o): TÃ©cnicos com foco em anÃ¡lise e melhoria

**Por Categoria:**
- **Ambiental**: TÃ©cnicos com conhecimento ambiental
- **Social**: TÃ©cnicos com experiÃªncia comunitÃ¡ria
- **EconÃ³mico**: TÃ©cnicos com background administrativo

## ğŸ“Š Componentes a Criar

### 1. Service Layer
```
app/Services/GrievanceTriageService.php
- assignToOptimalTechnician(Grievance $grievance)
- calculateTechnicianScore(User $technician, Grievance $grievance)
- getTechnicianWorkload(User $technician)
- isAvailable(User $technician)
```

### 2. Migration
```
database/migrations/YYYY_MM_DD_add_expertise_fields_to_users_table.php
- expertise_categories (JSON nullable)
- expertise_types (JSON nullable)
- is_available (boolean default true)
- max_concurrent_grievances (integer default 10)
```

### 3. Command (Artisan)
```
app/Console/Commands/AssignPendingGrievances.php
php artisan grievances:auto-assign
- Executa triagem em lote de grievances pendentes
- Pode rodar via cron job a cada X minutos
```

### 4. Event Listener
```
app/Listeners/AutoAssignGrievance.php
- Escuta evento GrievanceCreated
- Executa triagem automÃ¡tica se configurado
```

### 5. Dashboard de Carga
```
resources/js/Pages/Manager/TechnicianWorkload.vue
- VisualizaÃ§Ã£o em tempo real da carga de cada tÃ©cnico
- GrÃ¡ficos de distribuiÃ§Ã£o
- OpÃ§Ã£o de re-atribuiÃ§Ã£o manual se necessÃ¡rio
```

## ğŸ”§ ConfiguraÃ§Ã£o

Arquivo `config/grievance.php`:
```php
'auto_assign' => [
    'enabled' => env('GRIEVANCE_AUTO_ASSIGN', true),
    'urgent_priority_only' => false,
    'max_workload_per_technician' => 10,
    'workload_weights' => [
        'submitted' => 1,
        'under_review' => 2,
        'in_progress' => 3,
        'pending_approval' => 1,
    ],
]
```

## ğŸ“ˆ MÃ©tricas e Logs

**MÃ©tricas a capturar:**
- Tempo mÃ©dio de atribuiÃ§Ã£o
- Taxa de re-atribuiÃ§Ã£o
- DistribuiÃ§Ã£o de carga entre tÃ©cnicos
- Tempo de resoluÃ§Ã£o por tÃ©cnico/categoria

**Logs:**
```
[TRIAGEM] Grievance #GRM-2025-ABC123 atribuÃ­da ao tÃ©cnico JoÃ£o Silva
[TRIAGEM] Score: 75 pontos | Carga atual: 3/10 | Expertise: Ambiental
```

## ğŸ¯ Casos de Uso

### Caso 1: ReclamaÃ§Ã£o Urgente
```
1. Utente submete reclamaÃ§Ã£o urgente de cabo partido
2. Sistema detecta prioridade "urgent"
3. Triagem automÃ¡tica encontra tÃ©cnico JoÃ£o (carga: 2/10)
4. AtribuiÃ§Ã£o imediata + notificaÃ§Ã£o ao tÃ©cnico
5. Gestor notificado da atribuiÃ§Ã£o automÃ¡tica
```

### Caso 2: Queixa Ambiental
```
1. Queixa sobre desflorestaÃ§Ã£o submetida
2. Sistema identifica categoria "ambiental"
3. Busca tÃ©cnicos com expertise_categories contendo "ambiental"
4. Entre candidatos, escolhe o com menor carga
5. AtribuiÃ§Ã£o + email ao tÃ©cnico + email ao utente
```

### Caso 3: Todos Sobrecarregados
```
1. SugestÃ£o de baixa prioridade submetida
2. Todos tÃ©cnicos estÃ£o em carga mÃ¡xima (10/10)
3. Sistema mantÃ©m na fila "pending_assignment"
4. Gestor recebe alerta de fila crescendo
5. Quando carga diminui, auto-atribui ao primeiro disponÃ­vel
```

## âœ… CritÃ©rios de AceitaÃ§Ã£o

- [ ] Service GrievanceTriageService implementado
- [ ] Migration para expertise executada
- [ ] Comando artisan para triagem em lote funcional
- [ ] Event listener para auto-atribuiÃ§Ã£o no evento Created
- [ ] Dashboard mostra carga de trabalho em tempo real
- [ ] Testes unitÃ¡rios para algoritmo de pontuaÃ§Ã£o
- [ ] Testes de integraÃ§Ã£o para fluxo completo
- [ ] DocumentaÃ§Ã£o de configuraÃ§Ã£o
- [ ] Seeder atualizado com expertise dos tÃ©cnicos de teste
- [ ] Logs adequados de triagem

## ğŸ§ª Testes

```php
// TechnicianTriageTest.php
test('atribui ao tÃ©cnico com menor carga')
test('respeita expertise de categoria')
test('prioriza tÃ©cnico disponÃ­vel')
test('nÃ£o atribui a tÃ©cnico em fÃ©rias')
test('respeita limite mÃ¡ximo de carga')
test('urgente vai para tÃ©cnico menos ocupado')
```

## ğŸ“ BenefÃ­cios

âœ… **EficiÃªncia**: Reduz tempo de atribuiÃ§Ã£o de horas para segundos
âœ… **Balanceamento**: Distribui carga uniformemente
âœ… **Qualidade**: Match de expertise melhora taxa de resoluÃ§Ã£o
âœ… **Escalabilidade**: Suporta crescimento de volume
âœ… **TransparÃªncia**: Logs e mÃ©tricas para auditoria
âœ… **Flexibilidade**: Gestor pode sobrescrever se necessÃ¡rio

## ğŸ”— Issues Relacionadas

- #10: NotificaÃ§Ã£o AutomÃ¡tica (integraÃ§Ã£o com triagem)
- #9: ConfiguraÃ§Ã£o de Queues (para processar triagem async)

## ğŸ‘¤ Implementador

Edson Jorge - TECHSOLUTIONS

## ğŸ·ï¸ Labels

`enhancement`, `automation`, `ai-triagem`, `critical`, `backend`
