<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard — Gestor de Reclamações</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #FF6B35;
      --primary-light: #FF8E63;
      --primary-dark: #E55A2B;
      --secondary: #2D3748;
      --accent: #4A5568;
      --background: #F7FAFC;
      --card-bg: #FFFFFF;
      --text: #2D3748;
      --text-light: #718096;
      --text-lighter: #A0AEC0;
      --success: #48BB78;
      --warning: #ED8936;
      --danger: #F56565;
      --info: #4299E1;
      --border: #E2E8F0;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --radius: 12px;
      --sidebar-width: 280px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--background);
      color: var(--text);
      line-height: 1.5;
    }

    .app {
      display: flex;
      min-height: 100vh;
    }

    /* SIDEBAR */
    .sidebar {
      width: var(--sidebar-width);
      background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 24px 0;
      box-shadow: var(--shadow-lg);
      z-index: 10;
      display: flex;
      flex-direction: column;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 0 24px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 24px;
    }

    .logo {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .brand-text h1 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .brand-text div {
      font-size: 13px;
      opacity: 0.8;
    }

    .nav {
      flex: 1;
      padding: 0 16px;
    }

    .nav a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-radius: 8px;
      color: rgba(255, 255, 255, 0.9);
      text-decoration: none;
      margin-bottom: 4px;
      transition: all 0.2s;
      font-weight: 500;
    }

    .nav a:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      transform: translateX(4px);
    }

    .nav a.active {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .nav a .badge {
      margin-left: auto;
      background: rgba(255, 255, 255, 0.2);
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
    }

    .sidebar-footer {
      padding: 24px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: auto;
    }

    .role-info {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 16px;
    }

    .role-info strong {
      display: block;
      margin-bottom: 8px;
      font-size: 15px;
    }

    .activities {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 16px;
    }

    .activities-title {
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .activities ul {
      list-style: none;
      font-size: 13px;
    }

    .activities li {
      padding: 4px 0;
      position: relative;
      padding-left: 16px;
    }

    .activities li:before {
      content: "•";
      position: absolute;
      left: 0;
      color: white;
    }

    /* MAIN CONTENT */
    .main {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .search {
      display: flex;
      gap: 12px;
      align-items: center;
      background: white;
      padding: 12px 16px;
      border-radius: 10px;
      min-width: 360px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      transition: all 0.3s;
    }

    .search:focus-within {
      box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
      border-color: var(--primary);
    }

    .search input {
      background: transparent;
      border: 0;
      outline: none;
      color: var(--text);
      width: 100%;
      font-size: 14px;
    }

    .search input::placeholder {
      color: var(--text-lighter);
    }

    .controls {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .btn {
      background: var(--primary);
      color: white;
      padding: 10px 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 500;
      font-size: 14px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: var(--shadow);
    }

    .btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(255, 107, 53, 0.3);
    }

    .btn.secondary {
      background: white;
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn.secondary:hover {
      background: #f8f9fa;
      box-shadow: var(--shadow);
    }

    .btn.small {
      padding: 6px 12px;
      font-size: 12px;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-left: 12px;
    }

    .user-avatar {
      width: 44px;
      height: 44px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      box-shadow: var(--shadow);
      transition: all 0.3s;
    }

    .user-avatar:hover {
      transform: scale(1.05);
    }

    .user-info {
      text-align: right;
    }

    .user-info div:first-child {
      font-size: 12px;
      color: var(--text-light);
    }

    .user-info div:last-child {
      font-weight: 600;
    }

    /* GRID LAYOUT */
    .grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 20px;
    }

    .card {
      background: var(--card-bg);
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      transition: all 0.3s;
    }

    .card:hover {
      box-shadow: var(--shadow-lg);
    }

    .kpi {
      grid-column: span 3;
      display: flex;
      flex-direction: column;
    }

    .list {
      grid-column: span 5;
    }

    .detail {
      grid-column: span 4;
    }

    .kpi h3 {
      margin: 0;
      font-size: 14px;
      color: var(--text-light);
      font-weight: 500;
    }

    .kpi .value {
      font-size: 28px;
      font-weight: 700;
      margin: 8px 0 4px;
      color: var(--primary);
    }

    .kpi .description {
      font-size: 13px;
      color: var(--text-light);
    }

    /* COMPLAINT LIST */
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .section-header h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }

    .section-header-info {
      font-size: 13px;
      color: var(--text-light);
    }

    .filters {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .filters select {
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: white;
      color: var(--text);
      font-size: 14px;
      outline: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .filters select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.2);
    }

    .complaint-row {
      display: flex;
      gap: 16px;
      align-items: flex-start;
      padding: 16px;
      border-radius: 10px;
      margin-bottom: 12px;
      background: white;
      border: 1px solid var(--border);
      cursor: pointer;
      transition: all 0.2s;
    }

    .complaint-row:hover {
      border-color: var(--primary-light);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      transform: translateY(-2px);
    }

    .complaint-row.selected {
      border-color: var(--primary);
      background: rgba(255, 107, 53, 0.03);
      box-shadow: 0 4px 8px rgba(255, 107, 53, 0.1);
    }

    .complaint-row .user-avatar-small {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      background: var(--primary-light);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: white;
      flex-shrink: 0;
    }

    .complaint-row .meta {
      flex: 1;
    }

    .complaint-header {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }

    .complaint-title {
      font-weight: 600;
      font-size: 15px;
    }

    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
    }

    .pill.high {
      background: rgba(245, 101, 101, 0.1);
      color: var(--danger);
    }

    .pill.medium {
      background: rgba(237, 137, 54, 0.1);
      color: var(--warning);
    }

    .pill.low {
      background: rgba(72, 187, 120, 0.1);
      color: var(--success);
    }

    .pill.status-open {
      background: rgba(245, 101, 101, 0.1);
      color: var(--danger);
    }

    .pill.status-progress {
      background: rgba(66, 153, 225, 0.1);
      color: var(--info);
    }

    .pill.status-requested {
      background: rgba(237, 137, 54, 0.1);
      color: var(--warning);
    }

    .pill.status-closed {
      background: rgba(72, 187, 120, 0.1);
      color: var(--success);
    }

    .complaint-desc {
      color: var(--text-light);
      font-size: 14px;
      margin-bottom: 8px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .complaint-meta {
      font-size: 12px;
      color: var(--text-lighter);
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .complaint-actions {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .list-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
    }

    .list-footer small {
      color: var(--text-light);
    }

    .list-actions {
      display: flex;
      gap: 8px;
    }

    /* DETAILS PANEL */
    .detail-section {
      margin-bottom: 20px;
    }

    .detail-section h4 {
      margin-bottom: 12px;
      font-size: 16px;
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .detail-section h4 i {
      color: var(--primary);
    }

    .attachments {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .attachment {
      width: 80px;
      height: 60px;
      border-radius: 8px;
      background: #f8f9fa;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid var(--border);
      color: var(--text-light);
      position: relative;
      overflow: hidden;
    }

    .attachment:hover {
      background: #e9ecef;
      border-color: var(--primary-light);
      transform: translateY(-2px);
    }

    .attachment::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 107, 53, 0.1);
      opacity: 0;
      transition: opacity 0.2s;
    }

    .attachment:hover::after {
      opacity: 1;
    }

    .activity-log {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
    }

    .activity-item {
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-date {
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 4px;
    }

    /* CHARTS & INDICATORS */
    .indicators-card {
      grid-column: span 12;
    }

    .indicators-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .charts-container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .chart-wrapper {
      flex: 1;
      min-width: 250px;
      background: white;
      border-radius: 8px;
      padding: 16px;
      box-shadow: var(--shadow);
    }

    .indicators-table {
      min-width: 250px;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
    }

    .table th, .table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    .table th {
      font-weight: 600;
      color: var(--text-light);
      font-size: 14px;
    }

    .table tr:hover {
      background: rgba(255, 107, 53, 0.02);
    }

    /* MODAL */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 24px;
      z-index: 1000;
    }

    .modal {
      background: white;
      padding: 24px;
      border-radius: 12px;
      min-width: 400px;
      max-width: 600px;
      width: 100%;
      box-shadow: var(--shadow-lg);
      animation: modalAppear 0.3s ease-out;
    }

    @keyframes modalAppear {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal h3 {
      margin-bottom: 16px;
      font-size: 18px;
      font-weight: 600;
    }

    .modal-body {
      margin-bottom: 20px;
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    /* NOTIFICATION */
    .notification {
      position: fixed;
      top: 24px;
      right: 24px;
      background: white;
      padding: 16px 20px;
      border-radius: 8px;
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 1001;
      transform: translateX(120%);
      transition: transform 0.3s;
      border-left: 4px solid var(--primary);
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      border-left-color: var(--success);
    }

    .notification.warning {
      border-left-color: var(--warning);
    }

    .notification.error {
      border-left-color: var(--danger);
    }

    .notification.info {
      border-left-color: var(--info);
    }

    /* RESPONSIVE */
    @media (max-width: 1200px) {
      .grid {
        grid-template-columns: repeat(6, 1fr);
      }
      
      .kpi {
        grid-column: span 6;
      }
      
      .list, .detail {
        grid-column: span 6;
      }
    }

    @media (max-width: 768px) {
      .app {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        position: sticky;
        top: 0;
      }
      
      .topbar {
        flex-direction: column;
        gap: 16px;
        align-items: stretch;
      }
      
      .search {
        min-width: auto;
      }
      
      .controls {
        justify-content: space-between;
      }
      
      .kpi {
        grid-column: span 12;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">GR</div>
        <div class="brand-text">
          <h1>Gestor de Reclamações</h1>
          <div>Painel do Gestor</div>
        </div>
      </div>
      
      <nav class="nav">
        <a href="#" class="active"><i class="fas fa-chart-line"></i> Dashboard <span class="badge" id="badge-open">5</span></a>
        <a href="#"><i class="fas fa-exclamation-circle"></i> Reclamações <span class="badge" id="badge-complaints">5</span></a>
        <a href="#"><i class="fas fa-comment-alt"></i> Queixas & Sugestões <span class="badge" id="badge-suggestions">2</span></a>
        <a href="#"><i class="fas fa-check-circle"></i> Solicitações de Conclusão <span class="badge" id="badge-requests">3</span></a>
        <a href="#"><i class="fas fa-users"></i> Técnicos</a>
        <a href="#"><i class="fas fa-chart-bar"></i> Relatórios</a>
        <a href="#"><i class="fas fa-tachometer-alt"></i> Indicadores</a>
        <a href="#"><i class="fas fa-folder-open"></i> Projetos (visualizar)</a>
        <a href="#"><i class="fas fa-cog"></i> Configurações</a>
      </nav>
      
      <div class="sidebar-footer">
        <div class="role-info">
          <strong>Função: Gestor de Reclamações</strong>
          Responsável por receber, analisar, classificar e gerir reclamações até conclusão.
        </div>
        
        <div class="activities">
          <div class="activities-title">Atividades Principais:</div>
          <ul>
            <li>Analisar e classificar reclamações</li>
            <li>Atribuir técnicos adequados</li>
            <li>Monitorar progresso</li>
            <li>Aprovar conclusões</li>
          </ul>
        </div>
      </div>
    </aside>

    <main class="main">
      <div class="topbar">
        <div class="search">
          <i class="fas fa-search"></i>
          <input id="q" placeholder="Procure por utente, descrição ou ID" />
        </div>
        
        <div class="controls">
          <button class="btn" id="btn-export">
            <i class="fas fa-file-export"></i>
            Exportar CSV
          </button>
          
          <button class="btn secondary" id="btn-filter">
            <i class="fas fa-filter"></i>
            Filtros Avançados
          </button>
          
          <div class="user-profile">
            <div class="user-info">
              <div>Olá,</div>
              <div>Gestor</div>
            </div>
            <div class="user-avatar">G</div>
          </div>
        </div>
      </div>

      <section class="grid">
        <div class="card kpi">
          <h3>Total em Aberto</h3>
          <div class="value" id="kpi-open">5</div>
          <div class="description">Reclamações não resolvidas</div>
        </div>
        
        <div class="card kpi">
          <h3>Em Progresso</h3>
          <div class="value" id="kpi-progress">2</div>
          <div class="description">Com técnicos atribuídos</div>
        </div>
        
        <div class="card kpi">
          <h3>Urgentes (Alta)</h3>
          <div class="value" id="kpi-high">1</div>
          <div class="description">Encaminhar ao Director se crítico</div>
        </div>
        
        <div class="card kpi">
          <h3>Solicitações de Conclusão</h3>
          <div class="value" id="kpi-requests">3</div>
          <div class="description">Aguardando aprovação</div>
        </div>

        <div class="card list">
          <div class="section-header">
            <h3>Reclamações Recentes</h3>
            <div class="section-header-info">Ordenado por mais recente</div>
          </div>

          <div class="filters">
            <select id="filter-priority">
              <option value="all">Prioridade: Todos</option>
              <option value="high">Alta</option>
              <option value="medium">Média</option>
              <option value="low">Baixa</option>
            </select>
            
            <select id="filter-status">
              <option value="all">Status: Todos</option>
              <option value="open">Aberto</option>
              <option value="progress">Em Progresso</option>
              <option value="requested">Solicitado Conclusão</option>
              <option value="closed">Concluído</option>
            </select>
            
            <select id="filter-category">
              <option value="all">Categoria: Todas</option>
              <option value="infra">Infraestrutura</option>
              <option value="serv">Serviço</option>
              <option value="atend">Atendimento</option>
            </select>
            
            <select id="filter-type">
              <option value="all">Tipo: Todos</option>
              <option value="complaint">Reclamação</option>
              <option value="suggestion">Sugestão</option>
              <option value="complaint">Queixa</option>
            </select>
          </div>

          <div id="complaints-list">
            <!-- rows inserted by JS -->
          </div>

          <div class="list-footer">
            <small>Mostrando <span id="countShown">0</span> de <span id="countTotal">0</span></small>
            <div class="list-actions">
              <button class="btn secondary" id="btn-bulk-assign">Atribuição Automática</button>
              <button class="btn" id="btn-bulk-export">Exportar Selecionados</button>
            </div>
          </div>
        </div>

        <div class="card detail">
          <h3>Detalhes da Reclamação</h3>
          <div id="detail-area" class="detail-section">
            <div style="text-align: center; padding: 40px 20px; color: var(--text-light);">
              <i class="fas fa-info-circle" style="font-size: 48px; margin-bottom: 16px; color: var(--primary-light);"></i>
              <p>Selecione uma reclamação à esquerda para ver detalhes.</p>
            </div>
          </div>

          <div class="detail-section">
            <h4><i class="fas fa-tasks"></i> Ações</h4>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
              <button class="btn" id="btn-priority"><i class="fas fa-flag"></i> Definir Prioridade</button>
              <button class="btn secondary" id="btn-reassign"><i class="fas fa-user-friends"></i> Reatribuir Técnico</button>
              <button class="btn secondary" id="btn-send-director"><i class="fas fa-paper-plane"></i> Enviar ao Director</button>
              <button class="btn" id="btn-mark-complete"><i class="fas fa-check"></i> Marcar como Concluído</button>
            </div>
          </div>

          <div class="detail-section">
            <h4><i class="fas fa-paperclip"></i> Anexos</h4>
            <div class="attachments" id="attachments">
              <!-- Attachments will be added here -->
            </div>
          </div>

          <div class="detail-section">
            <h4><i class="fas fa-history"></i> Histórico de Atividades</h4>
            <div id="activity-log" class="activity-log">
              <!-- Activity log will be added here -->
            </div>
          </div>
        </div>

        <div class="card indicators-card">
          <div class="indicators-header">
            <h3>Indicadores Rápidos</h3>
            <div class="section-header-info">Últimos 30 dias</div>
          </div>
          
          <div class="charts-container">
            <div class="chart-wrapper">
              <canvas id="chart-status" height="120"></canvas>
            </div>
            
            <div class="chart-wrapper">
              <canvas id="chart-priority" height="120"></canvas>
            </div>
            
            <div class="indicators-table">
              <table class="table">
                <thead>
                  <tr>
                    <th>Indicador</th>
                    <th>Valor</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Tempo médio de resolução</td>
                    <td id="avgTime">2.6 dias</td>
                  </tr>
                  <tr>
                    <td>Solicitações de conclusão</td>
                    <td id="reqComplete">3</td>
                  </tr>
                  <tr>
                    <td>Reaberturas</td>
                    <td id="reopens">1</td>
                  </tr>
                  <tr>
                    <td>Taxa de satisfação</td>
                    <td id="satisfaction">87%</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- MODAL -->
  <div class="modal-backdrop" id="modal">
    <div class="modal" role="dialog">
      <h3 id="modal-title">Modal</h3>
      <div id="modal-body" class="modal-body"></div>
      <div class="modal-actions">
        <button class="btn secondary" id="modal-cancel">Cancelar</button>
        <button class="btn" id="modal-ok">Confirmar</button>
      </div>
    </div>
  </div>

  <!-- NOTIFICATION -->
  <div class="notification" id="notification">
    <div id="notification-icon"></div>
    <div id="notification-text"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
  <script>
    // Sample data
    const complaints = [
      {id:101, user:'Ana Silva', title:'Iluminação pública faltando', desc:'Vários postes sem luzes na Av. Central', category:'infra', type:'complaint', priority:'high', status:'open', tech:'Técnico A', attachments:['foto1.jpg', 'relatorio.pdf'], date:'2025-11-14', activities:[
        {date: '14/11/2025', text: 'Reclamação criada pelo utente'},
        {date: '14/11/2025', text: 'Atribuída ao Técnico A'}
      ]},
      {id:102, user:'Carlos Pereira', title:'Demora no atendimento', desc:'Fila longa no balcão de atendimento', category:'atend', type:'complaint', priority:'medium', status:'progress', tech:'Técnico B', attachments:['foto1.jpg'], date:'2025-11-13', activities:[
        {date: '13/11/2025', text: 'Reclamação criada pelo utente'},
        {date: '13/11/2025', text: 'Atribuída ao Técnico B'}
      ]},
      {id:103, user:'João Costa', title:'Serviço interrompido', desc:'Corte inesperado de água', category:'serv', type:'complaint', priority:'high', status:'progress', tech:'Técnico C', attachments:['agua.png'], date:'2025-11-12', activities:[
        {date: '12/11/2025', text: 'Reclamação criada pelo utente'},
        {date: '12/11/2025', text: 'Atribuída ao Técnico C'}
      ]},
      {id:104, user:'Mariana Lopes', title:'Sugestão de melhoria', desc:'Adicionar lixeiras no parque', category:'infra', type:'suggestion', priority:'low', status:'open', tech:null, attachments:[], date:'2025-11-10', activities:[
        {date: '10/11/2025', text: 'Sugestão criada pelo utente'}
      ]},
      {id:105, user:'Pedro Gomes', title:'Queixa sobre ruído', desc:'Barulho noturno constante', category:'atend', type:'complaint', priority:'medium', status:'requested', tech:'Técnico B', attachments:[], date:'2025-11-08', activities:[
        {date: '08/11/2025', text: 'Reclamação criada pelo utente'},
        {date: '08/11/2025', text: 'Atribuída ao Técnico B'},
        {date: '10/11/2025', text: 'Solicitada conclusão do processo'}
      ]},
      {id:106, user:'Sofia Mendes', title:'Falta de sinalização', desc:'Ausência de placas na rotunda', category:'infra', type:'complaint', priority:'medium', status:'open', tech:null, attachments:[], date:'2025-11-07', activities:[
        {date: '07/11/2025', text: 'Reclamação criada pelo utente'}
      ]},
      {id:107, user:'Ricardo Alves', title:'Sugestão de app móvel', desc:'Desenvolver app para reportar problemas', category:'serv', type:'suggestion', priority:'low', status:'open', tech:null, attachments:[], date:'2025-11-05', activities:[
        {date: '05/11/2025', text: 'Sugestão criada pelo utente'}
      ]}
    ];

    // UI refs
    const listEl = document.getElementById('complaints-list');
    const detailEl = document.getElementById('detail-area');
    const attachmentsEl = document.getElementById('attachments');
    const activityLogEl = document.getElementById('activity-log');
    const countTotal = document.getElementById('countTotal');
    const countShown = document.getElementById('countShown');
    const badgeOpen = document.getElementById('badge-open');
    const badgeComplaints = document.getElementById('badge-complaints');
    const badgeSuggestions = document.getElementById('badge-suggestions');
    const badgeRequests = document.getElementById('badge-requests');

    // init
    function init(){
      countTotal.textContent = complaints.length;
      renderList(complaints);
      updateKPIs();
      setupListeners();
      renderCharts();
    }

    function renderList(data){
      listEl.innerHTML='';
      data.forEach(c=>{
        const row = document.createElement('div');
        row.className = 'complaint-row';
        
        const userInitials = c.user.split(' ').map(n => n[0]).join('').toUpperCase();
        
        row.innerHTML = `
          <div class="user-avatar-small">${userInitials}</div>
          <div class="meta">
            <div class="complaint-header">
              <div class="complaint-title">${c.title} — ${c.user}</div>
              <span class="pill ${c.priority}">${c.priority === 'high' ? 'Alta' : c.priority === 'medium' ? 'Média' : 'Baixa'}</span>
              <span class="pill status-${c.status}">${c.status === 'open' ? 'Aberto' : c.status === 'progress' ? 'Em Progresso' : c.status === 'requested' ? 'Solicitado' : 'Concluído'}</span>
            </div>
            <div class="complaint-desc">${c.desc}</div>
            <div class="complaint-meta">
              <span><i class="fas fa-hashtag"></i> #${c.id}</span>
              <span><i class="fas fa-tag"></i> ${c.category}</span>
              <span><i class="fas fa-file-alt"></i> ${c.type === 'complaint' ? 'Reclamação' : 'Sugestão'}</span>
              <span><i class="fas fa-calendar"></i> ${c.date}</span>
              <span><i class="fas fa-user-cog"></i> ${c.tech || 'Não atribuído'}</span>
            </div>
            <div class="complaint-actions">
              <button class="btn small view-details" data-id="${c.id}">
                <i class="fas fa-eye"></i> Ver detalhes
              </button>
            </div>
          </div>
        `;
        
        // Add event listener to the "View details" button
        const viewDetailsBtn = row.querySelector('.view-details');
        viewDetailsBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          document.querySelectorAll('.complaint-row').forEach(r => r.classList.remove('selected'));
          row.classList.add('selected');
          selectComplaint(c.id);
        });
        
        // Add event listener to the entire row
        row.addEventListener('click', () => {
          document.querySelectorAll('.complaint-row').forEach(r => r.classList.remove('selected'));
          row.classList.add('selected');
          selectComplaint(c.id);
        });
        
        listEl.appendChild(row);
      });
      countShown.textContent = data.length;
      badgeOpen.textContent = complaints.filter(x=>x.status!=='closed').length;
    }

    let selectedId = null;
    function selectComplaint(id){
      selectedId = id;
      const c = complaints.find(x=>x.id===id);
      const statusText = c.status === 'open' ? 'Aberto' : c.status === 'progress' ? 'Em Progresso' : c.status === 'requested' ? 'Solicitado' : 'Concluído';
      const typeText = c.type === 'complaint' ? 'Reclamação' : 'Sugestão';
      
      detailEl.innerHTML = `
        <div style="font-weight:600;font-size:18px">${c.title}</div>
        <div style="color:var(--text-light);margin-top:6px"><i class="fas fa-user"></i> Por: ${c.user} • <i class="fas fa-hashtag"></i> ID: #${c.id}</div>
        <p style="margin-top:12px;color:var(--text)">${c.desc}</p>
        <div style="margin-top:12px;color:var(--text-light); display: flex; flex-wrap: wrap; gap: 12px;">
          <span><i class="fas fa-tag"></i> <strong>Categoria:</strong> ${c.category}</span>
          <span><i class="fas fa-file-alt"></i> <strong>Tipo:</strong> ${typeText}</span>
          <span><i class="fas fa-flag"></i> <strong>Status:</strong> ${statusText}</span>
          <span><i class="fas fa-user-cog"></i> <strong>Técnico:</strong> ${c.tech || 'Não atribuído'}</span>
        </div>
      `;
      
      // Update attachments
      attachmentsEl.innerHTML = '';
      if(c.attachments && c.attachments.length){
        c.attachments.forEach(a=>{ 
          const d = document.createElement('div'); 
          d.className='attachment'; 
          d.innerHTML = `<i class="fas fa-file"></i> ${a}`;
          attachmentsEl.appendChild(d); 
        });
      } else { 
        attachmentsEl.innerHTML = '<div style="color:var(--text-light); text-align: center; width: 100%; padding: 20px;"><i class="fas fa-paperclip" style="font-size: 24px; margin-bottom: 8px; display: block;"></i>Sem anexos</div>'; 
      }
      
      // Update activity log
      activityLogEl.innerHTML = '';
      if (c.activities && c.activities.length) {
        c.activities.forEach(activity => {
          const activityEl = document.createElement('div');
          activityEl.className = 'activity-item';
          activityEl.innerHTML = `
            <div class="activity-date">${activity.date}</div>
            <div>${activity.text}</div>
          `;
          activityLogEl.appendChild(activityEl);
        });
      } else {
        activityLogEl.innerHTML = '<div class="activity-item" style="text-align: center; color: var(--text-light);"><i class="fas fa-info-circle"></i> Nenhuma atividade registada</div>';
      }
    }

    function updateKPIs(){
      document.getElementById('kpi-open').textContent = complaints.filter(x=>x.status==='open').length;
      document.getElementById('kpi-progress').textContent = complaints.filter(x=>x.status==='progress').length;
      document.getElementById('kpi-high').textContent = complaints.filter(x=>x.priority==='high').length;
      document.getElementById('kpi-requests').textContent = complaints.filter(x=>x.status==='requested').length;
      document.getElementById('countTotal').textContent = complaints.length;
      document.getElementById('reqComplete').textContent = complaints.filter(x=>x.status==='requested').length;
      
      // Update sidebar badges
      badgeComplaints.textContent = complaints.filter(x=>x.type==='complaint').length;
      badgeSuggestions.textContent = complaints.filter(x=>x.type==='suggestion').length;
      badgeRequests.textContent = complaints.filter(x=>x.status==='requested').length;
    }

    // filters
    function setupListeners(){
      document.getElementById('q').addEventListener('input', ()=> applyFilters());
      document.getElementById('filter-priority').addEventListener('change', ()=> applyFilters());
      document.getElementById('filter-status').addEventListener('change', ()=> applyFilters());
      document.getElementById('filter-category').addEventListener('change', ()=> applyFilters());
      document.getElementById('filter-type').addEventListener('change', ()=> applyFilters());

      document.getElementById('btn-export').addEventListener('click', exportCSV);
      document.getElementById('btn-bulk-export').addEventListener('click', ()=>{ showNotification('Função de exportar selecionados (exemplo)', 'info'); });
      document.getElementById('btn-reassign').addEventListener('click', ()=> openModal('Reatribuir Técnico', reassignBody(), ()=>{ reassignTech(); }));
      document.getElementById('modal-cancel').addEventListener('click', closeModal);
      document.getElementById('modal-ok').addEventListener('click', ()=>{ if(window._modalOk) window._modalOk(); closeModal(); });
      document.getElementById('btn-priority').addEventListener('click', ()=> openModal('Definir Prioridade', priorityBody(), ()=>{ setPriority(); }));
      document.getElementById('btn-mark-complete').addEventListener('click', ()=> markComplete());
      document.getElementById('btn-send-director').addEventListener('click', ()=>{ if(!selectedId){ showNotification('Selecione uma reclamação primeiro.', 'warning'); return;} sendToDirector(); });
      document.getElementById('btn-bulk-assign').addEventListener('click', ()=>{ autoAssign(); });
      document.getElementById('btn-filter').addEventListener('click', ()=>{ openAdvancedFilters(); });
    }

    function applyFilters(){
      const q = document.getElementById('q').value.toLowerCase();
      const p = document.getElementById('filter-priority').value;
      const s = document.getElementById('filter-status').value;
      const cat = document.getElementById('filter-category').value;
      const type = document.getElementById('filter-type').value;
      
      const filtered = complaints.filter(c=>{
        if(p!=='all' && c.priority!==p) return false;
        if(s!=='all' && c.status!==s) return false;
        if(cat!=='all' && c.category!==cat) return false;
        if(type!=='all' && c.type!==type) return false;
        if(q && !(c.user.toLowerCase().includes(q) || c.title.toLowerCase().includes(q) || (c.id+ '').includes(q) || c.desc.toLowerCase().includes(q))) return false;
        return true;
      });
      renderList(filtered);
    }

    function exportCSV(){
      const rows = [['ID','Utente','Título','Tipo','Categoria','Prioridade','Status','Técnico','Data']];
      complaints.forEach(c=> rows.push([c.id,c.user,c.title,c.type,c.category,c.priority,c.status,c.tech || '',c.date]));
      const csv = rows.map(r=> r.map(v=>'"'+String(v).replace(/"/g,'""')+'"').join(',')).join('\n');
      const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'reclamacoes_export.csv'; a.click(); URL.revokeObjectURL(url);
      showNotification('Relatório exportado com sucesso', 'success');
    }

    // modal helpers
    function openModal(title, bodyHTML, onOk){
      document.getElementById('modal-title').textContent = title;
      document.getElementById('modal-body').innerHTML = bodyHTML;
      document.getElementById('modal').style.display = 'flex';
      window._modalOk = onOk;
    }
    function closeModal(){ document.getElementById('modal').style.display='none'; window._modalOk = null; }

    function priorityBody(){
      const c = complaints.find(x=>x.id===selectedId);
      return `
        <div style="color:var(--text-light); margin-bottom: 12px;">Selecione a nova prioridade para a reclamação #${c.id}:</div>
        <div>
          <select id="modal-priority" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border);">
            <option value="high" ${c.priority==='high'?'selected':''}>Alta</option>
            <option value="medium" ${c.priority==='medium'?'selected':''}>Média</option>
            <option value="low" ${c.priority==='low'?'selected':''}>Baixa</option>
          </select>
        </div>
      `;
    }
    function setPriority(){
      if(!selectedId){ showNotification('Selecione uma reclamação primeiro.', 'warning'); return; }
      const v = document.getElementById('modal-priority').value;
      const c = complaints.find(x=>x.id===selectedId); 
      c.priority = v; 
      
      // Add activity
      if (!c.activities) c.activities = [];
      c.activities.push({
        date: new Date().toLocaleDateString('pt-BR'),
        text: `Prioridade alterada para ${v === 'high' ? 'Alta' : v === 'medium' ? 'Média' : 'Baixa'}`
      });
      
      updateKPIs(); 
      applyFilters(); 
      selectComplaint(selectedId);
      showNotification('Prioridade atualizada com sucesso', 'success');
    }

    function reassignBody(){
      const c = complaints.find(x=>x.id===selectedId);
      return `
        <div style="color:var(--text-light); margin-bottom: 12px;">Escolha o técnico para reatribuir a reclamação #${c.id}:</div>
        <div>
          <select id="modal-tech" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border);">
            <option value="">Não atribuído</option>
            <option value="Técnico A" ${c.tech==='Técnico A'?'selected':''}>Técnico A</option>
            <option value="Técnico B" ${c.tech==='Técnico B'?'selected':''}>Técnico B</option>
            <option value="Técnico C" ${c.tech==='Técnico C'?'selected':''}>Técnico C</option>
            <option value="Técnico D" ${c.tech==='Técnico D'?'selected':''}>Técnico D</option>
          </select>
        </div>
      `;
    }
    function reassignTech(){
      if(!selectedId){ showNotification('Selecione uma reclamação primeiro.', 'warning'); return; }
      const t = document.getElementById('modal-tech').value;
      const c = complaints.find(x=>x.id===selectedId); 
      c.tech = t; 
      c.status = t ? 'progress' : 'open';
      
      // Add activity
      if (!c.activities) c.activities = [];
      c.activities.push({
        date: new Date().toLocaleDateString('pt-BR'),
        text: `Técnico reatribuído para ${t || 'Nenhum'}`
      });
      
      updateKPIs(); 
      applyFilters(); 
      selectComplaint(selectedId);
      showNotification(`Técnico ${t ? 'reatribuído e notificado: ' + t : 'removido'} (simulação)`, 'success');
    }

    function markComplete(){
      if(!selectedId){ showNotification('Selecione uma reclamação primeiro.', 'warning'); return; }
      const c = complaints.find(x=>x.id===selectedId);
      if(c.status==='closed'){ showNotification('Esta reclamação já está concluída.', 'info'); return; }
      c.status='closed'; 
      
      // Add activity
      if (!c.activities) c.activities = [];
      c.activities.push({
        date: new Date().toLocaleDateString('pt-BR'),
        text: 'Processo marcado como concluído pelo gestor'
      });
      
      updateKPIs(); 
      applyFilters(); 
      selectComplaint(selectedId);
      showNotification('Processo marcado como concluído com sucesso', 'success');
    }

    function sendToDirector(){
      const c = complaints.find(x=>x.id===selectedId);
      
      // Add activity
      if (!c.activities) c.activities = [];
      c.activities.push({
        date: new Date().toLocaleDateString('pt-BR'),
        text: 'Encaminhado ao Director para análise'
      });
      
      selectComplaint(selectedId);
      showNotification('Reclamação enviada ao Director para análise. (notificação simulada)', 'info');
    }

    function autoAssign(){
      // basic round-robin example
      const techs = ['Técnico A','Técnico B','Técnico C'];
      let i=0;
      let assigned = 0;
      
      complaints.forEach(c=>{ 
        if(!c.tech && c.status !== 'closed'){ 
          c.tech = techs[i%techs.length]; 
          c.status='progress'; 
          
          // Add activity
          if (!c.activities) c.activities = [];
          c.activities.push({
            date: new Date().toLocaleDateString('pt-BR'),
            text: `Atribuído automaticamente a ${c.tech}`
          });
          
          i++; 
          assigned++;
        } 
      });
      
      updateKPIs(); 
      applyFilters(); 
      showNotification(`Atribuição automática aplicada a ${assigned} reclamações. Técnicos notificados (simulação).`, 'success');
    }

    function openAdvancedFilters(){
      openModal('Filtros Avançados', `
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
          <div>
            <label style="display:block;margin-bottom:4px;font-size:14px">Data Inicial</label>
            <input type="date" id="filter-date-start" style="width:100%;padding:8px;border-radius:6px;border:1px solid var(--border);background:white;color:var(--text)">
          </div>
          <div>
            <label style="display:block;margin-bottom:4px;font-size:14px">Data Final</label>
            <input type="date" id="filter-date-end" style="width:100%;padding:8px;border-radius:6px;border:1px solid var(--border);background:white;color:var(--text)">
          </div>
          <div>
            <label style="display:block;margin-bottom:4px;font-size:14px">Técnico</label>
            <select id="filter-tech" style="width:100%;padding:8px;border-radius:6px;border:1px solid var(--border);background:white;color:var(--text)">
              <option value="all">Todos</option>
              <option value="Técnico A">Técnico A</option>
              <option value="Técnico B">Técnico B</option>
              <option value="Técnico C">Técnico C</option>
              <option value="Técnico D">Técnico D</option>
            </select>
          </div>
          <div>
            <label style="display:block;margin-bottom:4px;font-size:14px">Com Anexos</label>
            <select id="filter-attachments" style="width:100%;padding:8px;border-radius:6px;border:1px solid var(--border);background:white;color:var(--text)">
              <option value="all">Todos</option>
              <option value="yes">Com anexos</option>
              <option value="no">Sem anexos</option>
            </select>
          </div>
        </div>
        <div style="margin-top:12px">
          <button class="btn" id="apply-advanced-filters" style="width:100%">Aplicar Filtros</button>
        </div>
      `, () => {
        // Apply advanced filters
        const dateStart = document.getElementById('filter-date-start').value;
        const dateEnd = document.getElementById('filter-date-end').value;
        const tech = document.getElementById('filter-tech').value;
        const attachments = document.getElementById('filter-attachments').value;
        
        // In a real implementation, you would apply these filters
        showNotification('Filtros avançados aplicados (simulação)', 'info');
      });
    }

    // Notification system
    function showNotification(message, type = 'info') {
      const notification = document.getElementById('notification');
      const notificationText = document.getElementById('notification-text');
      const notificationIcon = document.getElementById('notification-icon');
      
      // Set icon based on type
      let icon = 'ℹ️';
      if (type === 'success') icon = '✅';
      if (type === 'warning') icon = '⚠️';
      if (type === 'error') icon = '❌';
      
      notificationText.textContent = message;
      notificationIcon.textContent = icon;
      notification.className = `notification ${type} show`;
      
      // Auto hide after 5 seconds
      setTimeout(() => {
        notification.classList.remove('show');
      }, 5000);
    }

    // charts using Chart.js
    function renderCharts(){
      const statusCounts = {open:0,progress:0,requested:0,closed:0};
      const priCounts = {high:0,medium:0,low:0};
      complaints.forEach(c=>{ statusCounts[c.status] = (statusCounts[c.status]||0)+1; priCounts[c.priority] = (priCounts[c.priority]||0)+1; });

      const ctx1 = document.getElementById('chart-status').getContext('2d');
      new Chart(ctx1, {
        type:'doughnut', 
        data:{
          labels:['Aberto','Em Progresso','Solicitado','Concluído'],
          datasets:[{
            data:[statusCounts.open,statusCounts.progress,statusCounts.requested,statusCounts.closed],
            backgroundColor: ['#F56565', '#4299E1', '#ED8936', '#48BB78']
          }]
        }, 
        options:{
          plugins:{
            legend:{
              labels:{color:'#4A5568'}
            }
          }
        }
      });

      const ctx2 = document.getElementById('chart-priority').getContext('2d');
      new Chart(ctx2, {
        type:'bar', 
        data:{
          labels:['Alta','Média','Baixa'],
          datasets:[{
            label:'Contagem', 
            data:[priCounts.high,priCounts.medium,priCounts.low], 
            barThickness:20,
            backgroundColor: ['#F56565', '#ED8936', '#48BB78']
          }]
        }, 
        options:{
          scales:{
            x:{
              ticks:{color:'#4A5568'}
            }, 
            y:{
              ticks:{color:'#4A5568'}
            }
          }, 
          plugins:{
            legend:{display:false}
          }
        }
      });
    }

    // initial
    init();
  </script>
</body>
</html>