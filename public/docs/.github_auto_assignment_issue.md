# Issue: Sistema de Classifica√ß√£o e Atribui√ß√£o Autom√°tica de Reclama√ß√µes

## Descri√ß√£o
Implementar um sistema autom√°tico de classifica√ß√£o e atribui√ß√£o de reclama√ß√µes (grievances) aos t√©cnicos dispon√≠veis com base na carga de trabalho atual.

## Funcionalidades Requeridas

### 1. Classifica√ß√£o Autom√°tica por Tipo de Reclama√ß√£o
- [x] Classificar reclama√ß√µes por categoria (Energia, Infraestrutura, Equipamento, etc.) ‚úÖ
- [x] Classificar por prioridade (baixa, m√©dia, alta, urgente) ‚úÖ
- [x] Classificar por localiza√ß√£o (prov√≠ncia, distrito) ‚úÖ
- [x] Sistema de pontua√ß√£o para determinar especializa√ß√£o necess√°ria ‚úÖ

### 2. Sistema de Carga de Trabalho (Workload)
- [x] Adicionar campo `workload_capacity` ao modelo User (capacidade m√°xima) ‚úÖ
- [x] Adicionar campo `current_workload` ao modelo User (carga atual) ‚úÖ
- [x] Adicionar campo `is_available` ao modelo User (disponibilidade) ‚úÖ
- [x] Calcular carga autom√°tica baseada em reclama√ß√µes atribu√≠das e ativas ‚úÖ
- [x] Peso diferenciado por prioridade (urgente=4, alta=3, m√©dia=2, baixa=1) ‚úÖ

### 3. Sistema de Especializa√ß√£o por Categoria
- [x] Tabela pivot `user_specializations` (user_id, category, proficiency_level) ‚úÖ
- [x] N√≠veis: b√°sico (1), intermedi√°rio (2), avan√ßado (3), expert (4) ‚úÖ
- [x] Matching autom√°tico entre categoria de reclama√ß√£o e especializa√ß√£o do t√©cnico ‚úÖ

### 4. Algoritmo de Atribui√ß√£o Autom√°tica
- [x] Service class `GrievanceAutoAssignmentService` ‚úÖ
- [x] Filtrar t√©cnicos dispon√≠veis (role='T√©cnico', is_available=true) ‚úÖ
- [x] Filtrar por especializa√ß√£o na categoria (se dispon√≠vel) ‚úÖ
- [x] Filtrar por localiza√ß√£o (prov√≠ncia/distrito) quando relevante ‚úÖ
- [x] Ordenar por carga de trabalho (menor primeiro) ‚úÖ
- [x] Atribuir ao t√©cnico com menor carga e especializa√ß√£o adequada ‚úÖ
- [x] Fallback: atribuir ao t√©cnico com menor carga se nenhum especialista dispon√≠vel ‚úÖ

### 5. Triggers de Atribui√ß√£o Autom√°tica
- [x] Ao criar nova reclama√ß√£o (status='submitted') ‚úÖ
- [x] Ao liberar t√©cnico (status='resolved' ou 'rejected') ‚úÖ
- [x] Ao marcar t√©cnico como dispon√≠vel ‚úÖ
- [x] Comando artisan para reatribui√ß√£o em massa de reclama√ß√µes pendentes ‚úÖ

### 6. Dashboard e Monitoramento
- [ ] Painel de carga de trabalho para gestores ‚è≥
- [ ] Visualiza√ß√£o de disponibilidade dos t√©cnicos ‚è≥
- [ ] M√©tricas: tempo m√©dio de atribui√ß√£o, distribui√ß√£o de carga ‚è≥
- [ ] Alertas quando todos os t√©cnicos est√£o sobrecarregados ‚è≥

### 7. Regras de Neg√≥cio
- [x] T√©cnico n√£o pode exceder `workload_capacity` ‚úÖ
- [x] Reclama√ß√µes urgentes t√™m prioridade na atribui√ß√£o ‚úÖ
- [x] T√©cnicos especializados t√™m prefer√™ncia para suas categorias ‚úÖ
- [x] T√©cnicos da mesma regi√£o t√™m prefer√™ncia ‚úÖ
- [x] Notificar t√©cnico ao receber nova atribui√ß√£o autom√°tica ‚úÖ

## Estrutura T√©cnica

### Migrations
```
‚úÖ add_workload_fields_to_users_table (2025_11_22_051236)
‚úÖ create_user_specializations_table (2025_11_22_051219)
‚è≥ add_auto_assignment_fields_to_grievances_table (n√£o necess√°rio - campos j√° existem)
```

### Models
```
‚úÖ User (m√©todos workload implementados)
   - calculateWorkload()
   - updateWorkload()
   - canAcceptGrievance()
   - hasSpecialization()
   - getProficiencyLevel()
‚úÖ UserSpecialization (criado com relacionamentos)
‚úÖ Grievance (campos de atribui√ß√£o j√° existentes)
```

### Services
```
‚úÖ App\Services\GrievanceAutoAssignmentService (completo)
   - autoAssign()
   - findBestTechnician()
   - calculateTechnicianScore()
   - autoAssignPending()
   - rebalanceWorkload()
‚è≥ App\Services\TechnicianWorkloadService (pode ser implementado futuramente)
```

### Observers
```
‚úÖ App\Observers\GrievanceAssignmentObserver (implementado)
   - created() - atribui√ß√£o autom√°tica
   - updated() - atualiza√ß√£o de workload
```

### Jobs/Events
```
‚úÖ Events\GrievanceAutoAssigned (implementado)
‚úÖ Listeners\NotifyTechnicianOfAssignment (implementado com queue)
‚è≥ Jobs\AutoAssignGrievanceJob (opcional - pode usar event em vez de job)
```

### Commands
```
‚úÖ php artisan grievance:auto-assign-pending (implementado)
‚úÖ php artisan grievance:rebalance-workload (implementado)
```

## Status da Implementa√ß√£o
**üéâ IMPLEMENTA√á√ÉO COMPLETA (95%)** - Sistema totalmente funcional e operacional!

### ‚úÖ Completo (Core Features)
- Sistema de workload (campos, c√°lculos, atualiza√ß√£o autom√°tica)
- Sistema de especializa√ß√£o (tabela, relacionamentos, matching)
- Algoritmo de atribui√ß√£o autom√°tica (pontua√ß√£o 0-150 pts)
- Observer para atribui√ß√£o autom√°tica
- Comandos Artisan para gest√£o
- **Sistema de notifica√ß√µes autom√°ticas por email** ‚úÖ
- Event/Listener pattern com queue ass√≠ncrona
- Documenta√ß√£o completa

### ‚è≥ Pendente (Nice-to-Have)
- Dashboard de monitoramento
- Feature flags

## Prioridade
**Alta** - Esta funcionalidade √© cr√≠tica para otimizar a distribui√ß√£o de trabalho e reduzir tempo de resposta.

## Estimativa Original vs Real
- **Estimado**: 5-7 dias de desenvolvimento + testes
- **Real**: Core implementado ‚úÖ
- **Pr√≥ximos passos**: 2-3 dias para features complementares (dashboard, notifica√ß√µes)

## Notas T√©cnicas
- Usar filas (queues) para processamento ass√≠ncrono
- Implementar logs detalhados do processo de atribui√ß√£o
- Adicionar testes unit√°rios e de integra√ß√£o
- Considerar cache para c√°lculo de workload
- Implementar feature flag para ativar/desativar sistema autom√°tico

## Labels
`enhancement`, `auto-assignment`, `high-priority`, `technical-feature`
