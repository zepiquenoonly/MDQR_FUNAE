## ğŸ¯ Objetivo

Implementar sistema inteligente de **triagem e atribuiÃ§Ã£o automÃ¡tica** de Grievances (Queixas, ReclamaÃ§Ãµes, SugestÃµes) para tÃ©cnicos baseado em:
- **Disponibilidade** do tÃ©cnico
- **Carga de trabalho** atual (menor nÃºmero de casos ativos)
- **Tipo de Grievance** (especializaÃ§Ã£o por categoria)
- **Prioridade** do caso

## ğŸš¨ Problema Actual

Atualmente o sistema **nÃ£o possui triagem automÃ¡tica**:
- âŒ Gestor precisa atribuir manualmente cada caso
- âŒ NÃ£o considera carga de trabalho dos tÃ©cnicos
- âŒ Pode sobrecarregar alguns tÃ©cnicos enquanto outros ficam ociosos
- âŒ NÃ£o hÃ¡ balanceamento inteligente de casos
- âŒ Processo manual demora e pode gerar gargalos

## ğŸ’¡ SoluÃ§Ã£o Proposta

### 1ï¸âƒ£ Sistema de Triagem AutomÃ¡tica
Criar serviÃ§o `GrievanceTriageService` que:
- Analisa tipo e categoria da grievance
- Identifica tÃ©cnicos disponÃ­veis
- Calcula carga de trabalho de cada tÃ©cnico
- Atribui ao tÃ©cnico com menor carga
- Considera especializaÃ§Ã£o por categoria (opcional)

### 2ï¸âƒ£ CÃ¡lculo de Carga de Trabalho
```php
Carga = 
  (casos_ativos Ã— 1.0) + 
  (casos_prioridade_alta Ã— 0.5) + 
  (casos_prioridade_urgente Ã— 1.0)
```

### 3ï¸âƒ£ CritÃ©rios de AtribuiÃ§Ã£o
**Ordem de prioridade:**
1. TÃ©cnico **disponÃ­vel** (status ativo)
2. TÃ©cnico com **menor carga** de trabalho
3. TÃ©cnico com **especializaÃ§Ã£o** na categoria (se configurado)
4. TÃ©cnico com **melhor histÃ³rico** de resoluÃ§Ã£o (futuro)

### 4ï¸âƒ£ Tipos de Grievance Suportados
- **Queixa** (Grievance)
- **ReclamaÃ§Ã£o** (Complaint)
- **SugestÃ£o** (Suggestion)

## ğŸ“‹ ImplementaÃ§Ã£o

### Arquivos a Criar/Modificar

1. **`app/Services/GrievanceTriageService.php`** (NOVO)
   - `assignToAvailableTechnician(Grievance $grievance)`
   - `calculateTechnicianWorkload(User $technician)`
   - `findBestTechnician(Grievance $grievance)`
   - `getTechniciansByCategory(string $category)`

2. **`app/Models/User.php`** (ATUALIZAR)
   - Adicionar mÃ©todo `getActiveGrievancesCount()`
   - Adicionar mÃ©todo `getWorkloadScore()`
   - Adicionar scope `scopeAvailableTechnicians()`

3. **`database/migrations/xxxx_add_specialization_to_users_table.php`** (NOVO)
   - Campo `specialization` (json) para categorias
   - Campo `is_available` (boolean) para disponibilidade
   - Campo `max_active_cases` (integer) para limite de casos

4. **`app/Observers/GrievanceObserver.php`** (ATUALIZAR)
   - Chamar triagem automÃ¡tica no evento `created`
   - Enviar notificaÃ§Ã£o ao tÃ©cnico atribuÃ­do

5. **`app/Http/Controllers/GrievanceController.php`** (ATUALIZAR)
   - Adicionar endpoint para triagem manual: `POST /grievances/{id}/auto-assign`
   - Dashboard mostrando carga de tÃ©cnicos

## ğŸ¯ Casos de Uso

### Caso 1: SubmissÃ£o Nova
1. Utente submete queixa ambiental (prioridade alta)
2. Sistema identifica 5 tÃ©cnicos disponÃ­veis
3. Calcula carga: T1=3, T2=1, T3=5, T4=2, T5=4
4. âœ… Atribui ao T2 (menor carga)
5. Notifica T2 por email

### Caso 2: EspecializaÃ§Ã£o
1. ReclamaÃ§Ã£o categoria "Ambiental - DesflorestaÃ§Ã£o"
2. Sistema filtra tÃ©cnicos com especializaÃ§Ã£o "ambiental"
3. Entre especialistas, escolhe o com menor carga
4. âœ… Atribui ao especialista disponÃ­vel

### Caso 3: UrgÃªncia
1. SugestÃ£o com prioridade URGENTE
2. Sistema prioriza tÃ©cnicos com histÃ³rico de resoluÃ§Ãµes rÃ¡pidas
3. âœ… Atribui imediatamente ao melhor tÃ©cnico

## ğŸ“Š MÃ©tricas e Dashboard

**Dashboard de GestÃ£o:**
- ğŸ“Š Carga atual de cada tÃ©cnico (grÃ¡fico de barras)
- ğŸ“ˆ DistribuiÃ§Ã£o de casos por tÃ©cnico
- â±ï¸ Tempo mÃ©dio de resoluÃ§Ã£o por tÃ©cnico
- ğŸ¯ Taxa de sucesso (resolvidas vs rejeitadas)
- ğŸš¦ Status de disponibilidade dos tÃ©cnicos

## âœ… CritÃ©rios de AceitaÃ§Ã£o

- [ ] ServiÃ§o `GrievanceTriageService` criado e testado
- [ ] Migration para especializaÃ§Ã£o e disponibilidade
- [ ] Triagem automÃ¡tica funciona no evento `created`
- [ ] Endpoint manual de triagem disponÃ­vel
- [ ] NotificaÃ§Ã£o enviada ao tÃ©cnico atribuÃ­do
- [ ] Dashboard mostra carga de tÃ©cnicos em tempo real
- [ ] Testes unitÃ¡rios para cÃ¡lculo de carga
- [ ] Testes de integraÃ§Ã£o para atribuiÃ§Ã£o
- [ ] DocumentaÃ§Ã£o do algoritmo no cÃ³digo
- [ ] Logs detalhados de cada atribuiÃ§Ã£o

## ğŸ”§ ConfiguraÃ§Ã£o

**Arquivo:** `config/grievance.php` (NOVO)
```php
return [
    'auto_assign' => [
        'enabled' => true,
        'use_specialization' => true,
        'max_cases_per_technician' => 10,
        'workload_weights' => [
            'active_case' => 1.0,
            'high_priority' => 0.5,
            'urgent_priority' => 1.0,
        ],
    ],
];
```

## ğŸ§ª Testes NecessÃ¡rios

1. **Teste de Carga de Trabalho**
   - TÃ©cnico com 0, 5, 10 casos ativos
   - CÃ¡lculo correto do score de carga

2. **Teste de AtribuiÃ§Ã£o**
   - Atribui ao tÃ©cnico com menor carga
   - Respeita disponibilidade
   - Considera especializaÃ§Ã£o

3. **Teste de Edge Cases**
   - Todos os tÃ©cnicos no limite mÃ¡ximo
   - Nenhum tÃ©cnico disponÃ­vel
   - Apenas um tÃ©cnico no sistema

## ğŸ“ Exemplo de Log

```
[2025-11-22 15:30:45] GrievanceTriageService: Iniciando triagem para Grievance #GRM-2025-ABC123
[2025-11-22 15:30:45] - Tipo: ReclamaÃ§Ã£o | Categoria: Ambiental | Prioridade: Alta
[2025-11-22 15:30:45] - TÃ©cnicos disponÃ­veis: 5
[2025-11-22 15:30:45] - Carga calculada: T1=3.5, T2=1.0, T3=5.5, T4=2.0, T5=4.5
[2025-11-22 15:30:45] - Melhor candidato: T2 (JoÃ£o Silva) - Carga: 1.0
[2025-11-22 15:30:45] âœ… Grievance atribuÃ­da a T2 com sucesso
[2025-11-22 15:30:46] ğŸ“§ NotificaÃ§Ã£o enviada para joao.silva@funae.gov.mz
```

## ğŸ¯ BenefÃ­cios

âœ… **EficiÃªncia:** AtribuiÃ§Ã£o instantÃ¢nea sem intervenÃ§Ã£o manual
âœ… **Balanceamento:** DistribuiÃ§Ã£o justa de carga entre tÃ©cnicos
âœ… **Qualidade:** Casos atribuÃ­dos a tÃ©cnicos disponÃ­veis
âœ… **Escalabilidade:** Suporta crescimento da equipe
âœ… **TransparÃªncia:** Logs e mÃ©tricas detalhadas
âœ… **Flexibilidade:** ConfigurÃ¡vel por categoria e prioridade

## ğŸ”— Relacionado

- Issue #10: Sistema de NotificaÃ§Ãµes (jÃ¡ implementado)
- Issue #30: Dados de Performance para Testes
- PR #32: Tipos de Grievances (Queixa/ReclamaÃ§Ã£o/SugestÃ£o)

## ğŸ·ï¸ Labels

`enhancement`, `automation`, `triage`, `load-balancing`, `performance`, `high-priority`

## ğŸ‘¤ AtribuÃ­do

Equipa de Desenvolvimento TECHSOLUTIONS
